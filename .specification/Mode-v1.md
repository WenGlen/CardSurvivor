# 無限模式規格書 v1.0

> 本文檔定義 Survivor-X 的「無限模式（Infinite Mode）」玩法，包含完整遊戲流程、波次系統、敵人生成、抽卡機制、計分規則與介面設計。

---

## 1. 模式概述

### 1.1 核心玩法

無限模式是一個無盡生存挑戰。敵人會從畫面邊緣持續生成並向主角靠近發動攻擊，玩家需要操控主角閃避並利用卡片堆疊的技能消滅敵人。每完成一個波次（打倒指定數量的敵人），玩家可從三張隨機卡片中選擇一張，堆疊到三個卡槽之一。隨著波次推進，敵人數量、速度與強度不斷增加，直到主角陣亡為止。

### 1.2 勝負條件

- **無勝利條件**：無限模式沒有終點，目標是盡可能存活更久、推進更多波次
- **失敗條件**：主角 HP 歸零即為 Game Over

---

## 2. 遊戲流程

### 2.1 完整流程圖

```
模式選擇 → 初始抽卡（三選一）→ Wave 1 開始
                                    ↓
                              持續生成敵人
                                    ↓
                          打倒指定數量敵人？──否──→ 繼續戰鬥
                                    ↓ 是
                              波次結算動畫
                                    ↓
                            抽卡（三選一）
                                    ↓
                              下一波次開始
                                    ↓
                              （循環直到死亡）
                                    ↓
                            Game Over 結算
```

### 2.2 詳細流程

#### Phase 1：模式選擇

- 從主畫面選擇「無限模式」進入
- 顯示模式說明與歷史最佳紀錄

#### Phase 2：初始抽卡

- 遊戲開始前，玩家先獲得一次**免費三選一**
- 此次抽卡從**所有技能的銅卡**中隨機抽出 3 張（不重複技能）
- 選擇的卡片決定第一個卡槽的技能類型
- 選完後進入 Wave 1，主角已具備一個技能

#### Phase 3：戰鬥波次

- 每個波次有明確的**擊殺目標數**
- 畫面上持續生成敵人，敵人會主動靠近並攻擊主角
- HUD 上顯示當前波次進度（例：`12 / 16`）
- 達成擊殺目標後，進入波次結算

#### Phase 4：波次結算

- 所有畫面上的敵人**淡出消失**（不計入下一波次）
- 暫停敵人生成
- 顯示短暫的波次完成動畫（約 1.5 秒）
- 主角回復 **20% 最大 HP**（不超過上限）
- 進入抽卡介面

#### Phase 5：抽卡

- 顯示三張候選卡片供玩家選擇（詳見第 5 節）
- 選擇的卡片堆疊到對應的卡槽
- 選完後，下一波次立即開始

#### Phase 6：Game Over

- 主角 HP 歸零時觸發
- 畫面凍結 0.5 秒 → 主角死亡動畫 → 結算畫面（詳見第 7 節）

---

## 3. 波次系統

### 3.1 擊殺目標公式

| 波次 | 擊殺目標 | 公式 |
|------|---------|------|
| Wave 1 | 4 | `4 × 2^0` |
| Wave 2 | 8 | `4 × 2^1` |
| Wave 3 | 16 | `4 × 2^2` |
| Wave 4 | 32 | `4 × 2^3` |
| Wave 5 | 64 | `4 × 2^4` |
| Wave N | `4 × 2^(N-1)` | 翻倍成長 |

> 從 Wave 8（512 隻）起，指數成長的壓力會形成自然的難度天花板。

### 3.2 敵人生成規則

#### 生成位置

- 敵人從**畫面四邊外圍**隨機位置生成
- 生成點距離畫面邊緣 20~40px 的緩衝區外
- 每次生成時，優先在**離主角較遠的邊**生成，避免背刺感（70% 權重遠側，30% 權重其他側）

#### 生成節奏

- 每個波次有一個**基礎生成間隔**，隨波次推進縮短
- 同一波次內，生成間隔也會隨時間**緩慢加速**

| 波次 | 基礎生成間隔 | 波次內加速率 | 最小間隔 |
|------|------------|------------|---------|
| Wave 1 | 1.5 秒 | -2%/秒 | 0.8 秒 |
| Wave 2 | 1.3 秒 | -2%/秒 | 0.7 秒 |
| Wave 3 | 1.1 秒 | -3%/秒 | 0.6 秒 |
| Wave 4 | 0.9 秒 | -3%/秒 | 0.5 秒 |
| Wave 5+ | 0.8 秒 | -3%/秒 | 0.4 秒 |
| Wave 8+ | 0.6 秒 | -4%/秒 | 0.3 秒 |

> 公式：`spawnInterval = max(minInterval, baseInterval × (1 - accelRate × elapsedTime))`

#### 群體生成（Burst Spawn）

- 從 Wave 3 起，有機率觸發群體生成：一次生成 3~5 隻敵人
- 群體生成機率隨波次增加：`burstChance = min(0.3, 0.05 × waveNumber)`
- 群體生成的敵人在同一側、相鄰位置出現

### 3.3 畫面敵人上限

- 畫面上同時最多存在 **30 隻**敵人
- 達到上限時暫停生成，有敵人被消滅後恢復生成
- 此上限確保效能穩定與畫面可讀性

---

## 4. 敵人設計

### 4.1 敵人類型

#### 普通步兵（Walker）

- **外觀**：紅色圓形，size = 14
- **行為**：直線朝主角移動，接觸主角時造成傷害
- **基礎數值**：HP 20, 速度 60 px/s, 接觸傷害 5, 攻擊間隔 1.0 秒
- **出現時機**：所有波次

#### 快速衝鋒（Runner）

- **外觀**：橙色較小圓形，size = 10
- **行為**：快速朝主角移動，HP 低但速度快
- **基礎數值**：HP 10, 速度 120 px/s, 接觸傷害 3, 攻擊間隔 0.8 秒
- **出現時機**：Wave 2 起

#### 重裝坦克（Brute）

- **外觀**：深紅色大圓形，size = 22
- **行為**：緩慢移動，高 HP 高傷害
- **基礎數值**：HP 80, 速度 30 px/s, 接觸傷害 12, 攻擊間隔 1.5 秒
- **出現時機**：Wave 3 起

#### 遠程射手（Shooter）

- **外觀**：紫色圓形，size = 12
- **行為**：移動到距主角 150px 時停下，每隔一段時間發射子彈
- **基礎數值**：HP 15, 速度 50 px/s, 子彈傷害 8, 射擊間隔 2.0 秒, 子彈速度 200 px/s
- **出現時機**：Wave 4 起

### 4.2 敵人類型分佈

每個波次生成敵人時，按以下權重隨機選擇敵人類型：

| 波次 | Walker | Runner | Brute | Shooter |
|------|--------|--------|-------|---------|
| Wave 1 | 100% | — | — | — |
| Wave 2 | 70% | 30% | — | — |
| Wave 3 | 55% | 25% | 20% | — |
| Wave 4 | 40% | 25% | 20% | 15% |
| Wave 5+ | 35% | 25% | 20% | 20% |

### 4.3 敵人數值隨波次成長

所有敵人的基礎數值會隨波次提升：

| 數值 | 成長公式 | 說明 |
|------|---------|------|
| HP | `base × (1 + 0.15 × (wave - 1))` | 每波次 +15% |
| 速度 | `base × (1 + 0.05 × (wave - 1))` | 每波次 +5%（上限 2 倍） |
| 傷害 | `base × (1 + 0.10 × (wave - 1))` | 每波次 +10% |

> 速度成長設上限是為了確保玩家始終能透過走位閃避，不會出現無法反應的情況。

---

## 5. 抽卡系統

### 5.1 觸發時機

| 時機 | 說明 |
|------|------|
| 遊戲開始前 | 免費初始抽卡，從所有技能的銅卡中抽 3 張（不重複技能） |
| 每波次結束 | 完成擊殺目標後，固定一次三選一 |

### 5.2 卡片候選規則

#### 卡槽未滿（< 3 個技能）

- 3 張候選卡中，**至少 1 張來自尚未使用的技能**，引導玩家開啟新卡槽
- 其餘卡片可來自已使用的技能或其他未使用的技能
- 不會出現 3 張都是同一技能的情況

#### 卡槽已滿（3 個技能都已確定）

- 3 張候選卡**只從已選擇的 3 種技能中**抽取
- **允許同技能出現多張**：例如 3 張都是冰箭卡片
- 技能出現機率均等（每張卡的技能從 3 種中等機率選取）

### 5.3 卡片稀有度分佈

候選卡片的稀有度受波次影響：

| 波次 | 銅卡機率 | 銀卡機率 | 金卡機率 |
|------|---------|---------|---------|
| Wave 1~2 | 80% | 20% | 0% |
| Wave 3~4 | 60% | 35% | 5% |
| Wave 5~6 | 40% | 45% | 15% |
| Wave 7+ | 25% | 50% | 25% |

> 金卡從 Wave 3 才開始出現，給玩家先建立基礎技能結構的時間。

### 5.4 卡片放置邏輯

- 選中的卡片**自動放入對應技能的卡槽**末端
- 如果該技能尚未佔用任何卡槽：
  - 自動分配到第一個空卡槽
  - 該卡槽從此鎖定為此技能
- 如果該技能已有卡槽：直接堆疊到該卡槽末端
- 放入後立即重新計算技能快照（Sequential Stacking）

### 5.5 重複卡片處理

- 同一張卡片（同 id）可以被多次選入同一卡槽
- 堆疊效果依照 Sequential Stacking 規則正常運作
- 例如：兩張「冰箭數量 +2」依序放入 → 第一張產生 2 箭，第二張再產生 2 箭（均為初始數值）

---

## 6. 主角設計

### 6.1 基礎數值

| 數值 | 初始值 | 說明 |
|------|-------|------|
| HP | 100 | 最大生命值 |
| 速度 | 150 px/s | 移動速度 |
| 大小 | 12 | 碰撞半徑 |
| 無敵時間 | 0.5 秒 | 受傷後的無敵幀 |

### 6.2 受傷機制

- 敵人接觸主角時，每隔敵人的「攻擊間隔」造成一次傷害
- 受傷後有 0.5 秒無敵時間，期間不受任何傷害
- 受傷時主角閃爍（透明度交替）作為視覺回饋

### 6.3 技能發動

- 卡槽內有卡片的技能會**自動發動**，無需手動觸發
- 最多同時擁有 3 個自動發動的技能
- 各技能獨立冷卻、獨立計時

---

## 7. 計分系統

### 7.1 分數來源

| 來源 | 計算方式 | 說明 |
|------|---------|------|
| 擊殺分 | `10 × 敵人類型倍率` | 基礎得分 |
| 波次通關獎勵 | `100 × waveNumber` | 完成每波次的固定獎勵 |
| 連殺加成 | `killStreak × 0.1（上限 2.0）` | 2 秒內連續擊殺的倍率加成 |

#### 敵人類型倍率

| 敵人類型 | 倍率 |
|---------|------|
| Walker | ×1.0 |
| Runner | ×1.2 |
| Brute | ×2.0 |
| Shooter | ×1.5 |

### 7.2 連殺系統（Kill Streak）

- 每次擊殺敵人時，如果距離上次擊殺不超過 **2 秒**，連殺計數 +1
- 超過 2 秒未擊殺，連殺計數歸零
- 連殺倍率 = `1.0 + streak × 0.1`，上限為 `2.0`（即連殺 10 以上不再增加）
- 連殺數會顯示在 HUD 上（例：`×5 Streak!`）

### 7.3 最終分數

```
最終分數 = 擊殺累積分 + 波次獎勵累積 + 存活時間獎勵
存活時間獎勵 = floor(存活秒數) × 2
```

---

## 8. 介面設計

### 8.1 模式選擇畫面

```
┌──────────────────────────────────────┐
│           SURVIVOR-X                 │
│                                      │
│    ┌──────────────────────────┐      │
│    │     ♾️ 無限模式            │      │
│    │   最佳紀錄：Wave 7        │      │
│    │   最高分：12,450          │      │
│    │                          │      │
│    │       [ 開始 ]            │      │
│    └──────────────────────────┘      │
│                                      │
│    ┌──────────────────────────┐      │
│    │     🏋️ 練習場             │      │
│    └──────────────────────────┘      │
│                                      │
└──────────────────────────────────────┘
```

### 8.2 初始抽卡畫面

```
┌──────────────────────────────────────┐
│         選擇你的初始技能              │
│                                      │
│   ┌────────┐ ┌────────┐ ┌────────┐  │
│   │ 銅框    │ │ 銅框    │ │ 銅框    │  │
│   │        │ │        │ │        │  │
│   │ 冰箭   │ │ 火球   │ │ 電球    │  │
│   │ 數量+2 │ │ 傷害+15│ │ 速度+30│  │
│   │        │ │        │ │        │  │
│   │ [選擇] │ │ [選擇] │ │ [選擇] │  │
│   └────────┘ └────────┘ └────────┘  │
│                                      │
└──────────────────────────────────────┘
```

### 8.3 戰鬥中 HUD

```
┌──────────────────────────────────────────┐
│ HP [████████░░] 80/100     Wave 3        │
│ Score: 2,450    ×5 Streak!  12/16 kills  │
│                                          │
│  ┌──────── 遊戲畫面 ────────┐            │
│  │                          │            │
│  │     ○ ← 敵人             │            │
│  │          ↓               │            │
│  │        ● ← 主角          │            │
│  │       /|\  ← 技能效果    │            │
│  │                          │            │
│  └──────────────────────────┘            │
│                                          │
│  卡槽 A: 冰箭 [🟫🟫🥈]                   │
│  卡槽 B: 火球 [🟫🥈]                     │
│  卡槽 C: (空)                            │
│                                          │
└──────────────────────────────────────────┘
```

#### HUD 元素清單

| 元素 | 位置 | 說明 |
|------|------|------|
| HP 條 | 左上 | 綠色血條，低於 30% 變紅並閃爍 |
| 波次資訊 | 右上 | 顯示當前波次編號 |
| 擊殺進度 | 右上（波次下方） | `當前擊殺數 / 目標數` + 進度條 |
| 分數 | 左上（HP 下方） | 即時累計分數 |
| 連殺 | 中上 | 連殺數 ≥ 3 時顯示，帶縮放動畫 |
| 卡槽預覽 | 下方 | 3 個卡槽的迷你圖示，顯示技能圖標與卡片數量 |
| 存活時間 | 右上 | `MM:SS` 格式 |

### 8.4 波次結算動畫

- 畫面中央顯示 **「Wave N Complete!」** 文字，帶放大淡入效果
- 持續 1.5 秒後自動進入抽卡畫面
- 期間主角回復 HP 的動畫（綠色 +20% 浮動數字）

### 8.5 抽卡畫面（波次間）

```
┌──────────────────────────────────────┐
│        Wave 3 Complete!              │
│        選擇一張卡片                   │
│                                      │
│   ┌────────┐ ┌────────┐ ┌────────┐  │
│   │ 銅框    │ │ 銀框    │ │ 銅框    │  │
│   │        │ │        │ │        │  │
│   │ 冰箭   │ │ 冰箭   │ │ 火球   │  │
│   │ 數量+2 │ │ 追蹤   │ │ 反彈   │  │
│   │        │ │        │ │        │  │
│   │ → 槽A  │ │ → 槽A  │ │ → 槽B  │  │
│   │ [選擇] │ │ [選擇] │ │ [選擇] │  │
│   └────────┘ └────────┘ └────────┘  │
│                                      │
│  ── 當前卡槽狀態 ──                   │
│  A: 冰箭 [數量+2 → 貫穿+1]           │
│  B: 火球 [傷害+15]                   │
│  C: (空)                             │
│                                      │
└──────────────────────────────────────┘
```

- 每張卡片下方標註會放入哪個卡槽（`→ 槽A`）
- 畫面下方顯示當前卡槽狀態，供玩家做決策
- 滑鼠懸停卡片時，顯示卡片詳細描述與堆疊順序說明（`orderNote`）
- 點擊卡片後，該卡片飛入對應卡槽的動畫

### 8.6 Game Over 結算畫面

```
┌──────────────────────────────────────┐
│           GAME OVER                  │
│                                      │
│     最終波次：Wave 7                  │
│     存活時間：05:32                   │
│     總擊殺數：284                     │
│                                      │
│     ── 分數明細 ──                    │
│     擊殺分：3,280                    │
│     波次獎勵：2,800                  │
│     存活獎勵：664                     │
│     ──────────                       │
│     最終分數：6,744                   │
│                                      │
│     🏆 新紀錄！（前最佳：5,120）       │
│                                      │
│     ── 使用技能 ──                    │
│     冰箭（6 張卡片）                  │
│     火球（4 張卡片）                  │
│     電球（3 張卡片）                  │
│                                      │
│     [ 再來一局 ]    [ 回主畫面 ]       │
│                                      │
└──────────────────────────────────────┘
```

---

## 9. 技術實作要點

### 9.1 遊戲狀態機

```
type InfiniteGamePhase =
  | 'pre_game'        // 模式選擇
  | 'initial_pick'    // 初始抽卡
  | 'battle'          // 戰鬥中
  | 'wave_clear'      // 波次結算動畫（1.5 秒）
  | 'card_pick'       // 抽卡選擇
  | 'game_over'       // 結算畫面
```

### 9.2 波次狀態

```typescript
interface WaveState {
  waveNumber: number            // 當前波次（從 1 開始）
  killTarget: number            // 本波次擊殺目標
  currentKills: number          // 本波次已擊殺數
  totalKills: number            // 總擊殺數
  spawnTimer: number            // 生成計時器
  currentSpawnInterval: number  // 當前生成間隔
  waveStartTime: number         // 本波次開始時間
}
```

### 9.3 計分狀態

```typescript
interface ScoreState {
  score: number                 // 當前總分
  killScore: number             // 擊殺累積分
  waveBonus: number             // 波次獎勵累積
  killStreak: number            // 當前連殺數
  lastKillTime: number          // 上次擊殺時間戳
  bestStreak: number            // 最佳連殺紀錄
}
```

### 9.4 卡槽狀態

```typescript
interface SlotState {
  slots: [CardSlot, CardSlot, CardSlot]  // 固定 3 個卡槽
}

interface CardSlot {
  skillId: string | null          // 鎖定的技能 id，null 表示空槽
  cards: CardDefinition[]         // 堆疊的卡片序列
}
```

### 9.5 抽卡候選生成

```typescript
interface CardPickState {
  candidates: CardDefinition[]    // 3 張候選卡片
  selectedIndex: number | null    // 玩家選擇的索引
}
```

### 9.6 紀錄持久化

使用 `localStorage` 儲存歷史最佳紀錄：

```typescript
interface InfiniteRecord {
  bestWave: number                // 最佳波次
  bestScore: number               // 最高分數
  bestKills: number               // 最多擊殺
  bestSurvivalTime: number        // 最長存活時間（秒）
  gamesPlayed: number             // 遊玩次數
}
```

Key：`survivor-x-infinite-record`

---

## 10. 數值平衡備註

### 10.1 設計目標

- **Wave 1~3**：新手學習期，節奏緩和，讓玩家理解卡片堆疊
- **Wave 4~6**：核心體驗期，三個技能成型，感受 build 威力
- **Wave 7~9**：壓力區，需要精確走位與合理的卡片搭配
- **Wave 10+**：極限挑戰，設計上預期只有頂尖玩家能觸及

### 10.2 預期遊戲時長

| 玩家程度 | 預期存活波次 | 預期遊戲時長 |
|---------|------------|------------|
| 新手 | Wave 3~4 | 2~3 分鐘 |
| 熟練 | Wave 6~7 | 5~7 分鐘 |
| 精通 | Wave 9~10 | 10~15 分鐘 |

### 10.3 後續可調整參數

以下參數應設為可配置常數，方便後續平衡調整：

- 初始擊殺目標（預設 4）
- 擊殺目標成長倍率（預設 2）
- 波次結算回復比例（預設 20%）
- 敵人 HP/速度/傷害 成長率
- 生成間隔與加速率
- 畫面敵人上限
- 連殺時間窗口
- 卡片稀有度分佈表
