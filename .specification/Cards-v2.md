# 卡片系統核心機制設計文件 v2.0

> 本文檔定義了 Survivor-X 遊戲的核心卡片堆疊系統，採用「順序依賴堆疊（Sequential Stacking）」機制，將卡片組合從單純的數值遊戲轉變為「技能邏輯編寫」。

---

## 1. 核心設計哲學：順序依賴堆疊（Sequential Stacking）

### 1.1 設計理念

不同於一般遊戲將所有加成「加總」後套用，本遊戲的技能強度取決於**卡片放入的先後順序**。這意味著：

- **先加數量後平均強化**：得到多個威力相同、稍微增強的子彈/物件
- **先集中強化後增加數量**：得到一個威力強大的/物件 + 多個原始數值的子彈/物件

### 1.2 卡片效果類型

卡片效果分為兩大類：

#### 順序依賴效果（Sequential Effects）

這類卡片的效果會受到放入順序的影響，當中又分銅卡跟銀卡：

「銅卡」使用後得到的數值/效果提升上限固定，例如：

- **「所有子彈增加共 50 點傷害，但傷害會均分在所有子彈上」**：如果先放這張卡，再放數量卡，總傷害會均分到更多子彈上；反之，如果先放數量卡，再放這張卡，只有當時存在的子彈會獲得傷害加成
- **「新增一顆初始數值的電球」**：不斷前面有都少張卡片，新增加的電球數值都會等同初始電球。

「銀卡」使用的後得到數值/效果提升上限不固定，例如：

- **「電球數量隨攻擊力反向增加」**：電球平均攻擊力在20~40之間，可獲得3顆初始電球；平均攻擊力在41~70之間，可獲得2顆初始電球；平均攻擊力在71以上，可獲得1顆初始電球。
- **「現有冰錐附加緩速效果」**：現在擁有所有的冰錐都可以獲得緩速效果，但未來獲得的不會有緩速效果。


#### 全局效果（金卡，Golden Cards）

這類卡片的效果不受放入順序影響，會作用於所有現有和未來的子彈/物件：

- **「所有冰錐附加緩速效果，包含未來疊加的卡片」**：無論何時放入，所有冰錐（包括之後新增的）都會獲得緩速效果
- 金卡通常具有特殊標記，在 UI 上會有金色邊框或圖標

### 1.3 快照機制（Snapshot Mechanism）

為了達成「後面的卡片不套用前面效果」，系統採用**快照機制**：

- **技能實體（Skill Instance）**：每個卡槽維護一個「當前屬性快照（CurrentState）」
- **順序依賴卡**：直接修改快照中的數值，或根據「目前的快照」產生新的子彈/物件。
- **全局效果卡（金卡）**：不修改快照，而是附加到所有實例上，包括未來產生的實例

### 1.4 運作邏輯（線性演化模型）

系統在處理卡片序列時，會由左至右逐一讀取：

1. **初始啟動**：玩家放入第一張卡片（任何卡片都可以），開啟該技能類型，建立初始狀態
2. **順序依賴效果**：
   - 屬性修正卡：修改 `CurrentState` 的數值
   - 衍生卡：根據**「那一刻」**的 `CurrentState` 複製出一份新的實例
3. **全局效果**：金卡不修改快照，而是附加到所有實例（現有和未來）上
4. **後續隔離**：在此之後放入的順序依賴卡，只會修改 `CurrentState`（母體），**不會回溯修改已經產生的子體**

### 1.5 實例說明：電球技能

**初始狀態**：電球數量 1，攻擊力 20

**情況 A：第一張是「電球數量 +1」**
- 結果：2 顆電球，每顆攻擊力 20

**情況 B：第一張是「電球攻擊共 +10」**
- 結果：1 顆電球，攻擊力 30

**情況 C：序列為「電球數量 +1」→「電球攻擊共 +10」**
- 步驟 1：放入「電球數量 +1」，得到 2 顆電球（攻擊力 20）
- 步驟 2：放入「電球攻擊共 +10」，攻擊力均分給 2 顆電球，得到：
  - 電球 1（攻擊力 25）← 均分得到 +5 攻擊力
  - 電球 2（攻擊力 25）← 均分得到 +5 攻擊力

**情況 D：序列為「電球攻擊共 +10」→「電球數量 +1」**
- 步驟 1：放入「電球攻擊 +10」，得到 1 顆電球（攻擊力 30）
- 步驟 2：放入「電球數量 +1」，複製當前狀態，得到：
  - 電球 1（攻擊力 30）← 單獨獲得 +10 攻擊力的電球
  - 電球 2（攻擊力 20）← 新增電球未增加攻擊

**情況 E：加入金卡「所有電球附加感電效果」**
- 無論何時放入這張金卡，所有電球（包括之後新增的）都會附加感電效果

---

## 2. 系統基礎架構

### 2.1 槽位限制（Slot System）

- 主角擁有 **3 個固定卡槽**（Slot A, B, C）
- **每個卡槽只能放一種「類型（技能）」的卡片**
- **可以堆疊無限張同類卡片**
- 例如：
  - 卡槽 A：電球類型（3 張電球卡片）
  - 卡槽 B：冰錐類型（2 張冰錐卡片）
  - 卡槽 C：火球類型（1 張火球卡片）

### 2.2 卡片開啟機制

- **沒有所謂主動卡、修正卡的差別**
- **任一張卡片都可以是初始卡片**
- **第一張卡片類似開關**：會幫主角打開該類型的攻擊方式
- 例如：
  - 只要有任一電球類型卡片，就能得到 1 顆電球，初始攻擊力為 20
  - 第一張是「電球數量 +1」→ 開啟電球技能，得到 2 顆攻擊力 20 的電球（初始 1 顆 + 1 顆）
  - 第一張是「電球攻擊 +10」→ 開啟電球技能，得到 1 顆 30 攻擊力的電球（初始 20 + 10）

### 2.3 堆疊計算規則

- **順序依賴卡**：
  - 屬性修正：採用 `Multiplicative`（乘法）或 `Additive`（加法）計算，只作用於當前快照和母體
  - 衍生修正：根據當前快照複製，產生新的實例
- **全局效果卡（金卡）**：附加到所有實例（現有和未來），不修改快照

---

## 3. 技能參數池定義

為了應對多樣化的技能，所有技能共享一套通用的參數池，但每個技能類型只會使用部分參數。

### 3.1 完整參數列表

| 參數名稱 | 說明 | 單位 |
|---------|------|------|
| `damage` | 基礎傷害值 | 點數 |
| `cooldown` | 兩次攻擊間的間隔時間 | 秒 |
| `duration` | 持續時間，子彈/效果消失前的時間 | 秒 |
| `speed` | 移動/旋轉速度 | 像素/秒 或 度/秒 |
| `radius` | 範圍/半徑 | 像素 |
| `range` | 最大射程/作用距離 | 像素 |
| `angle` | 扇形角度 | 度 |
| `count` | 數量（子彈/物件數量） | 個數 |
| `pierceCount` | 穿透力，子彈可以穿過多少怪物 | 次數 |
| `bounceCount` | 彈跳次數 | 次數 |
| `splitCount` | 分裂數，擊中後是否產生小碎片 | 次數 |
| `spreadAngle` | 散射角度 | 度 |
| `knockback` | 擊退距離 | 像素 |
| `chance` | 機率值 | 0-1 |
| `slowRate` | 減速比例 | 0-1 |
| `captureLimit` | 囚禁數量上限 | 個數 |
| `chainCount` | 連鎖跳躍次數 | 次數 |
| `pullForce` | 吸引力強度 | 數值 |
| `tickRate` | 持續傷害的觸發頻率 | 次/秒 |
| `falloffRatio` | 隨距離衰減率 | 0-1 |
| `invincibleTime` | 無敵時間 | 秒 |
| `castRange` | 施法距離 | 像素 |


### 3.2 元素屬性（Elemental Tags）
每種技能都可透過卡片獲得對應的附加效果。
所有卡片都有可能觸發附加效果：


| 元素標籤 | 名稱 | 附加效果名稱 | 附加效果描述 | 觸發方式 | 疊加效果 |
|-----|-----|---------|---------|---------|---------|
| `ICE` | 冰凍 | 失溫 | 敵人一定時間內移動速度變慢固定比率 | 機率觸發 | 增加失溫時長，最多 5 秒 | 
| `FIRE` | 火焰 | 灼燒 | 敵人一定時間內受到持續受傷並降低攻擊力 | 機率觸發 | 降低攻擊力比例，最多 50% |     
| `LIGHTNING` | 電擊 | 麻痹 | 敵人短時間內無法進行做任何行動 | 機率觸發 | 重置附加效果 | 
| `WIND` | 風壓 | 擊退 | 敵人向後退一段距離並暫停一段極短的時間 | 必定觸發 | 重置附加效果 | 
| `POISON` | 毒液 | 中毒 | 敵人受到持續傷害 | 必定觸發 | 增加單位時間內持續傷害，無上限 | 
| `DASH` | 衝擊 | 暈眩 | 敵人短時間內無法進行做任何行動並降低防禦力 | 必定觸發 | 重置附加效果 | 
| `BUFF` | 強化 | 增強 | 主角增加某項數值一段時間 | 機率觸發 | 可疊加，無上限 | 
| `SPECIAL` | 特殊 | 個別描述 | 個別描述 | 個別描述 | 個別描述 |


### 3.2 傷害類型（Attack Tags）
所有傷害皆屬於下列類型之一，傷害類型會決定攻擊方式，並以影響計算會用到哪些參數

| 傷害標籤 | 名稱 | 攻擊方式 |
|-----|-----|---------|---------|
| `` | 投射物 | 會以最近的敵人為主要方向，發射實體子彈，有飛行時間，碰撞到敵人擊造成傷害，會被敵人阻擋。 |
| `` | 環繞物 | 實體物件在主角身邊環繞，物件會持續存在不會消失，碰撞到敵人擊造成傷害 |
| `` | 範圍 | 每隔一段時間間隔（冷卻時間）發動，會在指定範圍內所有敵人都會受到傷害 |
| `` | 碰撞 | 與主角接觸的敵人都會受到傷害 |
| `` | 控制 | 直接作用在敵人身上 |


### 3.3 技能名稱

- 每種技能有三種專精強化方向，但不代表所有卡片只有專精方向的強化。
- 所有卡片都有附加效果強化，但強化方向可能有所不同。

| 名稱 | 屬性標籤 | 傷害類型 | 核心概念描述 | 專精強化方向 |
|-----|-----|-----|---------|---------|
| 冰箭 | 冰凍 | 投射物 | 以主方向為軸心，平均往各方向發出數個冰錐。因平均個方向擴散，單體傷害較低 ｜ 1.增加數量 2.強化貫穿 3.強化附加效果 |
| 冰錐 | 冰凍 | 範圍 | 以主方向前方一段距離外的弧形為範圍，從地面射出冰錐。 | 1.增加範圍 2. 縮短冷卻時間 3.強化附加效果 | 
| 火球 | 火焰 | 投射物 | 向主角的前方丟出一顆火球，在落地的位置造成範圍傷害。因需要主動控制方向，傷害較高。 | 1.提升傷害 2.縮短冷卻時間 3.增加爆炸效果 |
| 光束 | 火焰 | 範圍 | 向主角前方的直線發射光束，造成範圍傷害。因需要主動控制方向，傷害較高。 | 1.提升傷害 2.增加範圍（寬度） 3.增加發射方向 |
| 電球 | 電擊 | 環繞物 ｜ 在主角身邊環繞兩顆旋轉的電球，傷害中等，但高機率觸發麻痺。 | 1.提升旋轉速度 2.增加數量 3.強化附加效果 |
| 電弧 | 電擊 | 投射物 ｜ 向主角最靠近的敵人產生一道電弧，命中敵人後會連鎖攻擊下一個離該敵人最近的敵人。攻擊力中等，低機率觸發麻痺 | 1.提升傷害 2.縮短冷卻時間 3.強化連鎖效果  | 
| 風刃 | 風壓 | 範圍 | 主角前方扇形區域發動利刃般的風刃，造成範圍傷害。冷卻時間較長。 | 1.提升傷害 2.增加攻擊範圍 3.增加發射方向 |
| 旋風 | 風壓 | 環繞物 | 會主角周圍緩慢繞圈的小型龍卷風。 | 1.提升傷害 2.增加範圍 3.強化附加效果 |
| 毒霧 | 毒液 | 範圍 | 在主角四周一定半徑放出毒霧，造成極小的範圍傷害。冷卻時間短，能快速疊加中毒狀態。 | 1.強化附加效果 2.增加攻擊範圍 3.縮短冷卻時間 |
| 毒刺 | 毒液 | 碰撞 | 敵人攻擊主角時，會造成反擊傷害並且能產生中毒效果。 | 1.強化附加效果 2.提升傷害 3.其他特殊效果 |
| 石彈 | 衝擊 | 投射物 | 像最近的敵人投出一塊大石頭，擊中後會產生濺射傷害。 | 1.增加爆炸效果 2.縮短冷卻時間 3.提升傷害 |
| 狂奔 | 衝擊 | 碰撞 | 主角每隔一段時間就會向前衝距離，會對衝刺期間碰到的所有敵人造成傷害 | 1.縮短冷卻時間 2.增加傷害範圍 3.提升衝刺距離 |

| 黑洞 | 特殊 | 範圍 |  |  |
| 水牢 | 特殊 | 控制 |  |  |	
| 魅惑 | 特殊 | 控制 |  |  |	
| 詛咒 | 特殊 | 控制 |  |  |	



